import nodemailer from 'nodemailer'; export async function POST(req: Request) { try { const body = await req.json(); const { name, company, email, phone, product, quantity, delivery, notes } = body || {}; if (!name || !email || !quantity || !delivery) { return Response.json({error: 'Missing required fields.'}, {status: 400}); } // SMTP config via environment variables (Vercel compatible) const host = process.env.SMTP_HOST; const port = Number(process.env.SMTP_PORT || '587'); const user = process.env.SMTP_USER; const pass = process.env.SMTP_PASS; const to = process.env.CONTACT_TO; // e.g. "orders@caviarlarimi.ch" const from = process.env.CONTACT_FROM || user; // e.g. "noreply@caviarlarimi.ch" if (!host || !user || !pass || !to || !from) { return Response.json( {error: 'Email is not configured yet. Please set SMTP_* and CONTACT_* environment variables.'}, {status: 500} ); } const transporter = nodemailer.createTransport({ host, port, secure: port === 465, auth: {user, pass} }); const subject = `New Caviar Request â€” ${quantity}${product ? ` (${product})` : ''}`; const text = [ 'NEW CAVIAR REQUEST', '------------------', `Name: ${name}`, `Company: ${company || '-'}`, `Email: ${email}`, `Phone: ${phone || '-'}`, `Product: ${product || '-'}`, `Quantity: ${quantity}`, '', 'Delivery / Address:', delivery, '', 'Notes:', notes || '-' ].join('\n'); await transporter.sendMail({ from, to, replyTo: email, subject, text }); return Response.json({ok: true}); } catch (e) { return Response.json({error: 'Server error.'}, {status: 500}); }
}
