'use client'; import {useMemo, useState} from 'react';
import {useTranslations} from 'next-intl';
import {useSearchParams} from 'next/navigation'; type Status = 'idle' | 'sending' | 'sent' | 'error'; const productMap: Record<string, string> = { beluga: 'Beluga', oscietra: 'Oscietra', imperial: 'Imperial'
}; export default function OfferPage() { const t = useTranslations('offer'); const params = useSearchParams(); const selectedProduct = useMemo(() => { const p = params.get('product') || ''; return productMap[p] ?? ''; }, [params]); const [status, setStatus] = useState<Status>('idle'); const [error, setError] = useState<string>(''); async function onSubmit(formData: FormData) { setStatus('sending'); setError(''); const payload = Object.fromEntries(formData.entries()); if (selectedProduct && !payload.product) payload.product = selectedProduct; try { const res = await fetch('/api/quote', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) }); if (!res.ok) { const data = await res.json().catch(() => ({})); throw new Error(data?.error || 'Request failed'); } setStatus('sent'); } catch (e: any) { setStatus('error'); setError(e?.message || 'Unknown error'); } } return ( <div className="container-page py-12"> <div className="mx-auto max-w-3xl"> <h1 className="text-3xl font-extrabold tracking-tight">{t('title')}</h1> <p className="mt-3 text-slate-600">{t('subtitle')}</p> <div className="mt-8 luxe-card p-6 md:p-8"> {status === 'sent' ? ( <div> <p className="text-lg font-bold text-brand-800">{t('successTitle')}</p> <p className="mt-2 text-slate-600">{t('successText')}</p> </div> ) : ( <form action={onSubmit} className="grid gap-4"> <div className="grid gap-4 md:grid-cols-2"> <div> <label className="text-sm font-semibold">{t('name')}</label> <input className="luxe-input mt-2" name="name" required placeholder={t('namePh')} /> </div> <div> <label className="text-sm font-semibold">{t('company')}</label> <input className="luxe-input mt-2" name="company" placeholder={t('companyPh')} /> </div> </div> <div className="grid gap-4 md:grid-cols-2"> <div> <label className="text-sm font-semibold">{t('email')}</label> <input className="luxe-input mt-2" name="email" type="email" required placeholder={t('emailPh')} /> </div> <div> <label className="text-sm font-semibold">{t('phone')}</label> <input className="luxe-input mt-2" name="phone" placeholder={t('phonePh')} /> </div> </div> <div className="grid gap-4 md:grid-cols-2"> <div> <label className="text-sm font-semibold">{t('product')}</label> <input className="luxe-input mt-2" name="product" defaultValue={selectedProduct} placeholder={t('productPh')} /> </div> <div> <label className="text-sm font-semibold">{t('quantity')}</label> <select className="luxe-input mt-2" name="quantity" required defaultValue=""> <option value="" disabled>{t('quantityChoose')}</option> <option value="30g">30g</option> <option value="50g">50g</option> <option value="100g">100g</option> <option value="250g">250g</option> <option value="500g">500g</option> <option value="1kg">1kg</option> </select> </div> </div> <div> <label className="text-sm font-semibold">{t('delivery')}</label> <textarea className="luxe-input mt-2 min-h-[110px]" name="delivery" required placeholder={t('deliveryPh')} /> <p className="mt-2 text-xs text-slate-500">{t('deliveryHint')}</p> </div> <div> <label className="text-sm font-semibold">{t('notes')}</label> <textarea className="luxe-input mt-2 min-h-[110px]" name="notes" placeholder={t('notesPh')} /> </div> {status === 'error' && ( <p className="rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"> {t('error')} {error} </p> )} <button className="luxe-button mt-2" type="submit" disabled={status === 'sending'}> {status === 'sending' ? t('sending') : t('send')} </button> <p className="text-xs text-slate-500">{t('privacy')}</p> </form> )} </div> </div> </div> );
}
